<!DOCTYPE html>
<html>

<head>
	<meta name="viewport" content="width=device-width, initial-scale=1">
	
	<link rel="manifest" href="/manifest.json">

	<script src="https://www.gstatic.com/firebasejs/4.1.3/firebase-app.js"></script>
	<script src="https://www.gstatic.com/firebasejs/4.1.3/firebase-messaging.js"></script>
	
	<style>
		button.coffee {
			display: inline-block;
			text-align: center;
			cursor: pointer;
			overflow: hidden;
			transition: background-color 0.3s linear;
		}
		button.coffee:after {
			content: "";
			display: block;
			position: absolute;
			width: 100%;
			height: 100%;
			top: 0;
			left: 0;
			pointer-events: none;
			background-image: radial-gradient(circle, black 20%, rgba(0, 0, 0, 0) 19%);
			transform: scale(5);
			opacity: 0;
			transition: transform 1.5s, opacity 1s;
		}
		button.coffee:active:after {
			transform: scale(0);
			opacity: .2;
			transition: 0s;
		}
	</style>
	
	<script>
		"use strict";
		var coffeeLight = coffeeLight || {};
		
		coffeeLight.size = 0.7;
		
		coffeeLight.buttonClick = () => {
			fetch("./coffee", {
			  "method": "POST",
			  "headers": {
				"content-type": "application/json",
				"cache-control": "no-cache",
			  },
			  "body": JSON.stringify({
				"name": coffeeLight.loadName()
			  })
			});
		};
		
		coffeeLight.changeName = () => {
			var name = prompt("Name");
			document.getElementById("nameSpan").innerText = name;
			localStorage.setItem("coffeeLight.name", name);
			init();
		};
		
		coffeeLight.loadName = () => {
			name = localStorage.getItem("coffeeLight.name") || "Coffee Lover";
			document.getElementById("nameSpan").innerText = name;
			return name;
		};
		
		coffeeLight.setStyle = () => {
			var availableSpace = Math.min(window.innerHeight, window.innerWidth);
			var diameter = coffeeLight.size * availableSpace;
			coffeeLight.button.style.width  = diameter + "px";
			coffeeLight.button.style.height = diameter + "px";
			coffeeLight.button.style.fontSize = 1.5 * diameter + "%";
			coffeeLight.button.style.borderWidth = 0.04 * diameter + "px";
			coffeeLight.button.style.margin = ((window.innerHeight - diameter)/2 + "px") + " " + ((window.innerWidth - diameter)/2 + "px");
			
			var handleHeight = 0.05 * diameter;
			var handleWidth  = 0.25 * diameter;
			
			if(window.innerWidth > window.innerHeight) {
				coffeeLight.handle.style.height = handleHeight + "px";
				coffeeLight.handle.style.width  = handleWidth  + "px";
				coffeeLight.handle.style.top  = (window.innerHeight - handleHeight)/2 + "px";
				coffeeLight.handle.style.left = (window.innerWidth - diameter)/2 - 0.95 * handleWidth + "px";
				coffeeLight.handle.style.borderRadius = "50% 0% 0% 50%";
			}
			else {
				coffeeLight.handle.style.width  = handleHeight + "px";
				coffeeLight.handle.style.height = handleWidth  + "px";
				coffeeLight.handle.style.left = (window.innerWidth  - handleHeight)/2 + "px";
				coffeeLight.handle.style.top  = (window.innerHeight + diameter)/2 + "px";
				coffeeLight.handle.style.borderRadius = "0% 0% 50% 50%";
			}
		}
		
		window.onload = () => {
			document.getElementById("changeNameBtn").onclick = coffeeLight.changeName;
			coffeeLight.button = document.getElementById("button");
			coffeeLight.button.onclick = coffeeLight.buttonClick;
			coffeeLight.handle = document.getElementById("handle");
			coffeeLight.setStyle();
			coffeeLight.loadName();
		};
		window.onresize = coffeeLight.setStyle;
	</script>
</head>

<body style="font-family: Arial; background-color: black; color: white;">
	<span>Hello <span id="nameSpan">Philipp</span>&nbsp;<button id="changeNameBtn">change name</button></span>
	
    <button class="coffee" id="button" style="outline:none; position: absolute; top:0; left: 0; background: #6F4E37; color: white; border: solid; border-radius: 50%; width: 70%; height: 70%;">
		I want coffee!
	</button>
	<div id="handle" style="position: absolute; background-color: white; border-radius: 50% 0% 0% 50%">
		
	</div>
	<script src="app.js"></script>
</body>

</html>